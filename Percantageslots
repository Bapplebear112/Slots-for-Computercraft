-- slotmachine_cc_fixed.lua
-- Timer-driven slot machine with proper monitor/speaker/dropper peripheral usage,
-- single-press spins, non-blocking flash, adjustable win rates, pity wins.

-- ===============================
-- SETTINGS (edit these)
-- ===============================

-- Peripheral configuration
local monitorSide   = "right"   -- advanced monitor
local speakerSide   = "top"     -- speaker
local dropperSide   = "back"    -- dropper/dispenser
local spinInputSide = "bottom"  -- redstone input
local spinOutputSide= "left"    -- redstone output indicator while spinning

-- Appearance
local frameColor       = colors.blue
local symbolBgColor    = colors.gray
local jackpotColor     = colors.lime
local winColor         = colors.green
local loseColor        = colors.red
local pityColor        = colors.orange
local jackpotTextColor = colors.yellow

-- Symbols: char, name, color
local symbols = {
    {char = "G", name = "G", color = colors.yellow},
    {char = "D", name = "D", color = colors.lightBlue},
    {char = "I", name = "I", color = colors.lightGray},
    {char = "B", name = "B", color = colors.orange},
    {char = "E", name = "E", color = colors.green},
    {char = "N", name = "N", color = colors.black}, -- jackpot
}

-- Payouts
local baseJackpot  = 10
local jackpotCap   = 128
local winPayouts   = { G=5, D=4, I=3, B=2, E=1, N=0 } -- jackpot handled separately
local pityPayout   = 1
local debugMode    = false

-- Spin configuration
local spinTime     = {1.0, 1.6, 2.2}
local spinSpeed    = 0.10

-- Flashing settings
local flashCount   = 6
local flashSpeed   = 0.20

-- Win rate percentages for triple wins (0-100)
local tripleWinRates = {
    G = 10,
    D = 8,
    I = 6,
    B = 4,
    E = 2,
    N = 1
}

-- Pity eligibility
local pityEligibility = { N=true, G=false, D=false, I=false, B=false, E=false }

-- ===============================
-- Peripheral setup
-- ===============================
local mon = nil
if monitorSide and peripheral.isPresent(monitorSide) and peripheral.getType(monitorSide) == "monitor" then
    mon = peripheral.wrap(monitorSide)
else
    mon = peripheral.find("monitor")
end
if not mon
